! FROM PICK_OPEN PROCEDURE
SH_TO_SELL ROUTINE
! GET NUMBER OF SHARES SELECTED TO SELL FOR THIS RECORD
! SET 'TO_SELL'
! 'TBLPTR' SET TO RECORD POINTER
    TO_SELL = 0                          !INITIALIZE VALUE
    LOOP X# = 1 TO RECORDS(OPN_TABLE)!LOOP THRU MEMORY TABLE
      GET(OPN_TABLE,X#)
      IF (ERROR()) THEN STOP('Open Table : ' & ERROR()).
      IF (TBLPTR = TBO:POINTER)          !IS THIS THE RECORD?
        TO_SELL = TBO:SHARES             !YES - SET # OF SHARES
        EXIT
    . .

!FROM PICK_OPEN PROCEDURE
TOT_TO_SELL ROUTINE
! TOTAL UP NUMBER OF SHARES TO SELL
    TOT_SHARES = 0                  !INITIAL COUNTER
    LOOP X# = 1 TO RECORDS(OPN_TABLE)!LOOP THROUGH MEMORY TABLE
     GET(OPN_TABLE,X#)
     IF (ERROR()) THEN STOP('Open Table : ' & ERROR()).
     TOT_SHARES += TBO:SHARES       !ADD UP SHARES
    .

!FROM ASK_SELL_SH PROCEDURE
ADD_OPN_SELL ROUTINE
! SEE IF ALREADY SELLING SOME SHARES FROM THIS RECORD.
! IS SO, UPDATE MEMORY TABLE ENTRY. 
! OTHERWISE, ADD TO MEMORY TABLE.
! 'OPNPTR' IS RECORD POINTER
    LOOP X# = 1 TO RECORDS(OPN_TABLE)!LOOP THROUGH MEMORY TABLE
      GET(OPN_TABLE,#)
      IF (ERROR()) THEN STOP('Open Table : ' & ERROR()).
      IF (OPNPTR = TBO:POINTER)     !IS THIS THE RECORD?
        TBO:SHARES = TO_SELL        !YES - UPDATE IT
        PUT(OPN_TABLE)
        EXIT                        !AND RETURN
    . .
    TBO:POINTER = OPNPTR            !ADD TO MEMORY TABLE
    TBO:SHARES = TO_SELL
    ADD(OPN_TABLE)
    IF (ERROR()) THEN STOP('Open Table : ' & ERROR()).

