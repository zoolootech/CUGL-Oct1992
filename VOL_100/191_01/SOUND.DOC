.op











                    S O U N D   E F F E C T S

                       C Function Library
                          Version 1.0b


               Copyright (C) 1986 by Paul Canniff
                      All Rights Reserved.




                          Paul Canniff
                          P.O. Box 1056
                        Marlton NJ 08053

                    CompuServe ID 73047,3715























                    
                                                Updated 05 Mar 86
.paŠ



                         C O N T E N T S

          Introduction  .......................  1
          Installation for Aztec C  ...........  2
          Installation for Ecosoft C  .........  3
          Installation for Lattice C  .........  4
          Installation for other compilers  ...  5
          Using The Library  ..................  6
          Making Music (using PLAY)  ..........  8
          Making Noise (using SOUND)  ......... 10
          Function Summary List  .............. 11
          Individual Function Descriptions  ... 12
          Technical Information  .............. 18
          What To Do When It Doesn't Work  .... 23
          Change Log .......................... 24
.paŠ.pn 1

                          Introduction

Thió librarù facilitateó thå uså oæ sounä anä musiã oî thå IBM-PÃ 
familù  anä  compatibles®   Iô haó beeî testeä witè  thå  Latticå 
compileò  versioî 2.1µ anä thå Manø Azteã compileò versioî  3.20®  
Otheò compileró (oò versionó oæ theså compilers© shoulä worë jusô 
fine¬  provideä  yoõ caî rewritå oò modifù thå  assembly-languagå 
portions®   É  wilì bå glaä tï helğ geô thå librarù workinç  witè 
other compilers.

Thå  maiî  functionó iî thå  librarù  arå  play()¬  sound()¬  anä 
sounds()®   Play(©  acceptó  á forí oæ  musicaì  notation¬  whilå 
sounds(©  anä sounds(© accepô specifiã frequencieó anä  durationó 
foò  greateò  flexibilitù  (aô thå expenså oæ morå worë  foò  thå 
programmer)®  Theså functionó arå discusseä iî morå detaiì iî thå 
sectionó "Makinç Music¢ anä "Makinç Noise"®  Calló tï sound(© anä 
play(©   caî  bå  freelù  intermixeä  iî  eitheò  foregrounä   oò 
background¬  providinç  á  flexiblå high-leveì interfacå  tï  thå 
speaker.

Alì  oæ  theså  sound-makinç routineó caî ruî  iî  foregrounä  oò 
background®  Foregrounä meanó thaô thå sounä ió generateä iî mucè 
thå  samå  waù  thaô mosô otheò  PÃ  outpuô  ió  generated»   thå 
applicatioî  requestó thaô iô bå done¬  thå driveò doeó  it¬  anä 
theî iô returnó tï thå application®   Thió ió straightforwarä anä 
clean.

Backgrounä ió thå fancù way®   Thå musiã oò thå sounä effectó arå 
requesteä  bù  thå application¬  whicè caî theî continuå  tï  ruî 
whilå thå driveò controló thå speaker®   Thió allowó yoõ tï  plaù 
somå  musiã  whilå youò prograí performó somå  operations¬  whicè 
might be better than just flashing WAIT at the user.

Iî addition¬  thå librarù includeó á numbeò oæ low-leveì routineó 
thaô accesó thå speakeò directly®  

.paŠ.he Sounä Effectó                                Generaì Installation

Thå  followinç  generaì  installatioî procedurå  applieó  tï  alì 
supporteä compilers®  

(1)  First¬ seô uğ youò "worë area"¬ whetheò iô bå á subdirectorù 
     oî  á harä disk¬  oò á floppù disk®   Iæ yoõ havå rooí oî  á 
     currenô worë disk¬  oò iî youò usuaì Ã subdirectory¬ yoõ maù 
     wanô  tï uså them®   Whereveò yoõ decidå upon¬  thió disë oò 
     diectory will be referred to as your "work area".

(2)  Copù alì .Ã anä .È fileó froí thå distributioî disë tï  youò 
     worë  area®   

(3)  Therå arå alsï somå assembly-langaugå sourcå fileó whicè yoõ 
     wilì need¬ calleä DELAÙ anä SOUNDINT®  Therå arå versionó oæ 
     theså fileó oî thå disë foò eacè supporteä  compiler®   Copù 
     thå  propeò fileó tï youò worë area¬  changinç thå extensioî 
     tï .ASÍ iî thå process.

            AZTEC:    *.ASZ  ->  *.ASM
            LATTICE:  *.ASL  ->  *.ASM
            ECOSOFT:  *.ASE  ->  *.ASM
    
(*)  Keeğ  thå originaì distributioî disë iî á safå  place»   alì 
     furtheò actionó discusseä shoulä bå donå oî youò worë  area¬ 
     noô thå distributioî disk.

(2)  Ediô  thå filå SOUND.È anä makå surå thaô thå onlù  compileò 
     flaç seô ió thå onå foò youò compiler®   Thaô flaç shoulä bå 
     set to 1, all others to 0.

(3)  Compilå  thå Ã files®   Theù includå thå followinç È  files¬ 
     which should be included with your compiler:

          Lattice, Ecosoft:     STDIO.H, DOS.H
          Aztec:                STDIO.H, MODEL.H

(4)  Assemblå  thå  .ASÍ fileó usinç thå assembleò provideä  witè 
     youò   compiler¬   thå  Miscrosofô   Macrï   Assembler¬   oò 
     equivalent®   Thå  followinç "macro¢ headeró arå includeä bù 
     the assembly files:

          Lattice:       DOS.MAC
          (all others)   -none-     

(5)  Thå  filå  SOUNDTSÔ  ió  noô á parô  oæ  thå  Sounä  Effectó 
     library¬  buô  ió furnisheä aó aî examplå oæ aî  applicatioî 
     callinç  thå sounä functions®   Tï tesô  thå  library¬  linë 
     SOUNDTSÔ  tï  alì  thå sounä functions¬  anä  anù  necessarù 
     modules.  The following modules are required:

          Lattice:       C.OBJ, LC.LIB
          Ecosoft:       ??
          Aztec:         C.LIB
.paŠ.he Sounä Effectó                         Installatioî - Manø ¯ Aztec

             Manx Aztec C Version 3.20 Installation

Note:  Oldeò Manø compileró (sucè aó versioî 1.06© shoulä requirå 
       nï changå tï thå followinç procedure.

Beforå  starting¬  seô  uğ  youò "worë area"¬  whetheò  iô  bå  á 
subdirectory on a hard disk, or a floppy disk.   Then ...

(1)  Copù  thå .Ã anä .È fileó tï youò worë diskettå oò harä disë 
     subdirectory®   Copù  alì .ASÌ fileó tï .ASÍ fileó  oî  youò 
     worë  area®   Keeğ thå originaì distributioî disë iî á  safå 
     place»  alì furtheò actionó discusseä shoulä bå donå oî youò 
     worë area¬ noô thå distributioî disk.

(2)  Ediô  thå filå SOUND.È anä makå surå thaô thå onlù  compileò 
     flag set to 1 is C_AZTEC. 

(3)  Compilå  thå Ã files®   Theù includå thå followinç È  files¬ 
     which should be included with your compiler:

          STDIO.H     MODEL.H

(4)  Assemblå  thå  .ASÍ  fileó usinç thå Manø  Azteã  Assembler¬ 
     Miscrosofô Macrï Assembleò oò equivalent.

(5)  Linë  thå filå SOUNDTEST.OBÊ tï thå resô oæ .OBJ'ó  produceä 
     bù thå abovå commands¬ anä tï thå Ã librarù (C.LIB)® 

(6)  Iæ  yoõ heaò music¬  yoõ havå correctlù installeä youò sounä 
     routines®   Yoõ  maù uså LIÂ oò PLIB8¶ tï forí theí  intï  á 
     librarù iæ yoõ want®   Notå thaô yoõ wilì havå tï repeaô thå 
     installatioî procedurå foò everù memorù modeì yoõ use®   Oh¬ 
     yes¬  yoõ  caî deletå thå SOUNDTSÔ fileó wheî yoõ arå  done¬ 
     thougè thå sourcå giveó á gooä examplå oæ thå correcô waù tï 
     accesó thå library.

                           Aztec Notes

(1)  Sound_done(© musô alsï bå calleä beforå exitinç aî  overlay¬ 
     iæ thå overlaù containó thå Sounä Effectó codå anä data®  Iæ 
     botè  codå anä datá oæ thå Sounä Effectó functionó residå iî 
     the root, this is not necessary.

.paŠ.he Sounä Effectó                              Installatioî - Ecosoft

               Ecosoft C Version 3.02 Installation

Beforå  starting¬  seô  uğ  youò "worë area"¬  whetheò  iô  bå  á 
subdirectory on a hard disk, or a floppy disk.   Then ...

(1)  Copù  thå .Ã anä .È fileó tï youò worë diskettå oò harä disë 
     subdirectory®   Copù  alì .ASE fileó tï .ASÍ fileó  oî  youò 
     worë  area®   Keeğ thå originaì distributioî disë iî á  safå 
     place»  all furtheò actionó discusseä shoulä bå donå oî youò 
     worë area¬ noô thå distributioî disk.

(2)  Ediô  thå filå SOUND.È anä makå surå thaô thå onlù  compileò 
     flag set to 1 is C_ECOSOFT.

(3)  Compilå  thå Ã files®   Theù includå thå followinç È  files¬ 
     which should be included with your Lattice Compiler:

          STDIO.H     DOS.H

(4)  Assemblå  thå .ASÍ fileó usinç thå Microsofô Macrï Assembleò 
     oò equivalent®   Thå filå PRO.È musô bå present®   Thió filå 
     ió includeä iî thå Ecosoft Ã packagå anä allowó thå assemblù 
     moduleó tï kno÷ thå memorù modeì iî use.

(5)  Linë  thå filå SOUNDTEST.OBÊ tï thå resô oæ .OBJ'ó  produceä 
     bù  thå  abovå  commands¬  anä  tï  thå  Ecosofô  Ã  librarù 
     (ECOC.LIB)® 

(6)  Iæ  yoõ heaò music¬  yoõ havå correctlù installeä youò sounä 
     routines®   Yoõ  maù uså LIÂ oò PLIB8¶ tï forí theí  intï  á 
     librarù iæ yoõ want®   Notå thaô yoõ wilì havå tï repeaô thå 
     installatioî procedurå foò everù memorù modeì yoõ use®   Oh¬ 
     yes¬  yoõ  caî deletå thå SOUNDTSÔ fileó wheî yoõ arå  done¬ 
     thougè thå sourcå giveó á gooä examplå oæ thå correcô waù tï 
     accesó thå library.

                          Ecosoft Notes

(1)  Thå  filå SOUNDP.È ió provideä tï definå thå  Sounä  Effectó 
     callablå  functions¬  usinç thå prototypå form®   Iæ yoõ arå 
     usinç  prototyping¬  thió  filå shoulä bå  includeä  iî  anù 
     source module that calls the Sound Effects library.

.paŠ.he Sounä Effectó                              Installatioî - Lattice

           Lattice C Version 2.14 or 2.15 Installation

Noteº  Thå ne÷ Latticå compileró (versioî 3.xx© shoulä requirå nï 
       changå tï thå followinç procedure.

Beforå  starting¬  seô  uğ  youò "worë area"¬  whetheò  iô  bå  á 
subdirectory on a hard disk, or a floppy disk.   Then ...

(1)  Copù  thå .Ã anä .È fileó tï youò worë diskettå oò harä disë 
     subdirectory®   Copù  alì .ASÌ fileó tï .ASÍ fileó  oî  youò 
     worë  area®   Keeğ thå originaì distributioî disë iî á  safå 
     place»  all furtheò actionó discusseä shoulä bå donå oî youò 
     worë area¬ noô thå distributioî disk.

(2)  Ediô  thå filå SOUND.È anä makå surå thaô thå onlù  compileò 
     flag set to 1 is C_LATTICE.

(3)  Compilå  thå Ã files®   Theù includå thå followinç È  files¬ 
     which should be included with your Lattice Compiler:

          STDIO.H     DOS.H

(4)  Assemblå thå .ASÍ fileó usinç thå Microsofô Macrï  Assembleò 
     oò equivalent®  Thå filå DOS.MAÃ musô bå present®  Thió filå 
     ió includeä iî thå Latticå Ã packagå anä allowó thå assemblù 
     modulås tï kno÷ thå memorù modeì iî use.

(5)  Linë  thå filå SOUNDTEST.OBÊ tï thå resô oæ .OBJ'ó  produceä 
     bù  thå  abovå  commands¬  anä  tï  thå  Latticå  Ã  librarù 
     (LC.LIB). 

(6)  Iæ  yoõ heaò music¬  yoõ havå correctlù installeä youò sounä 
     routines®   Yoõ  maù uså LIÂ oò PLIB8¶ tï forí theí  intï  á 
     librarù iæ yoõ want®   Notå thaô yoõ wilì havå tï repeaô thå 
     installatioî procedurå foò everù memorù modeì yoõ use®   Oh¬ 
     yes¬  yoõ  caî deletå thå SOUNDTSÔ fileó wheî yoõ arå  done¬ 
     thougè thå sourcå giveó á gooä examplå oæ thå correcô waù tï 
     accesó thå library.

                          Lattice Notes

(1)  Wheî compilinç thå Sounä Effectó functions¬  bå usurå tï uså 
     thå  correcô  compileò flagó anä DOS.MAÃ file¬  sï thaô  thå 
     Sounä  Effectó functionó arå usinç thå samå memorù modeì  aó 
     youò application®   Yoõ maù wanô tï compilå fouò versionó oæ 
     the Sound Effects functions, one for each memory model.

(2)  Bå  surå  tï compilå Sounä Effectó functionó usinç thå  "-v¢ 
     compileò flaç tï disablå stacë checking®  Thió ió compatiblå 
     witè  thå  Latticå library®   Noô disablinç  stacë  checkinç 
     coulä resulô iî detectioî oæ á boguó "stacë overflow¢ durinç 
     thå   timeò  interrupô  handler'ó  execution®    Thió   wilì 
     terminate the application.
.paŠ.he Sounä Effectó                               Installatioî - Others


                     Non-Supported Compilers

Tï  uså  thå  Sounä Effectó librarù witè á  compileò  otheò  thaî 
Latticå  oò  Aztec¬  yoõ  wilì  havå tï  bå  familiaò  witè  youò 
compileò  iî ordeò tï customizå thå fe÷ assembleò routines®   Thå 
followinç  questionó shoulä bå answereä first®   Thå answeró  foò 
thå supporteä compileró arå giveî foò reference.


                                            Lattice  Manx  Yours?
                                            -------  ----  ------
 o Doeó  youò compileò appenä oò  prepenä 
   aî  underscorå  tï  thå namå  oæ  eacè 
   function?                                   N      Y

 o Where does the compiler put parameters?   Stack   Stack

 o Wherå  doeó  youò compileò  placå  itó 
   return values for int?                     AX      AX
   For long int?                             AX,BX   DX,AX

 o Doeó youò compileò uså neaò calls¬ faò 
   calls, or allows both?                    Both    Both

 o What provision does your library make     inp()  inport()
   for access to the I/O ports?             outp()  outport()


.paŠ.he Sound Effects                                 General Information

                        Using The Library

Usinç thå Sounä Effectó librarù ió similaò tï usinç thå  standarä 
library'ó  I/Ï functions®   Therå ió aî "open"¬  somå operations¬ 
thå  á  "close"®   Iî thå case¬  thå openinç functioî  ió  calleä 
sound_init(© anä thå closinç functioî ió sound_done()®  Onå poinô 
thaô  cannoô  bå stresseä overmucè ió thå importancå  oæ  callinç 
sound_done(©  beforå exitinç thå program®   Anù applicatioî whicè 
useó  thå sounä librarù shoulä calì sound_done(© aô alì  possiblå 
exiô points.

Note the following things about sound_done():

     (1)  Iô  neveò  hurtó tï calì  it®   Sound_done(©  knowó  iæ 
          sound_init(© haó beeî called¬ anä actó accordingly.

     (2)  Wheî calleä iô wilì kilì anù musiã stilì playing.

Thå oppositå numbeò oæ sound_done(© ió sound_init()¬  whï  shoulä 
(oæ  course© bå calleä first¬  beforå anù otheò sounä  functions®  
Iô  ió possiblå tï geô awaù withouô callinç sound_init()¬  iæ yoõ 
wanô tï plaù iî modå 1®   Buô iô reallù ió mucè neateò tï calì iô 
anyway.

Whaô ió modå 1¿   Glaä yoõ asked®   Iî thå play(© function¬ therå 
ió á MODÅ sub-commanä whicè haó tï dï witè ho÷ noteó arå  played®  
Buô  outsidå  oæ thaô littlå corner¬  wheî wå saù "mode¢  wå  arå 
talkinç abouô theî WHEÎ anä HO× oæ thå sounä output.

Yoõ  goô  á  tastå oæ thå meaninç oæ modeó iî thå  discussioî  oæ 
Backgrounä  anä  Foregrounä  iî  thå   introduction.    Real-timå 
programmers¬  forgeô youò usuaì understandinç oæ theså terms®  Iî 
termó  oæ thió librarù musiã playinç iî Foregrounä playó wheî yoõ 
telì  iô to¬  anä youò applicatioî caî dï nothinç elså untiì  thå 
musiã ió finished®   Musiã iî Backgrounä ió jusô "seô up¢ bù youò 
commanä tï play¬  anä actuallù playó whilå youò applicatioî runs®  
So¬  iô  ió  "backgrounä music¢ foò thå  application¬  hencå  thå 
terminology®  

Notå   thaô   thå   termó  musiã  anä  sounä  arå   useä   ratheò 
interchangeably®    Musiã  usinç  normaì  noteó  ió  mosô  easilù 
generateä  bù  thå play(© function¬  whilå sound(© giveó  á  morå 
flexiblå  interfacå iæ yoõ arå intï  strangå  frequencies®   Botè 
functionó caî operatå iî Foregrounä anä Background.

.cp 12ŠTherå  arå  actuallù fivå modeó iî whicè thå sounä  routineó  caî 
run®  Seå thå "Technicaì Information¢ sectioî foò á morå completå 
descriptioî oæ thå timinç techniques®  Thå defaulô modå ió 1.

  Mode      When          Timing Method
  ----   ----------    -------------------------
    1    Foreground    Delay Loop
    2    Foreground    Standard Clock Interrupt
    3    Foreground    Enhanced Clock Interrupt  (*)
    4    Background    Standard Clock Interrupt
    5    Background    Enhanced Clock Interrupt  (*)


Thå  modå numbeò showî abovå ió thå valuå yoõ shoulä givå tï  thå 
firsô parameteò tï sound_init()®  Thå seconä parameteò ió sueä aó 
á  true/falså flag¬  anä telló sound_init(© whetheò tï instalì  á 
breaë handler®   Thå breaë handleò actó aó á safetù feature»   iô 
makeó surå thaô sound_done(© ió calleä beforå thå applicatioî  ió 
terminated by the user typing Control-C or Control-Break.

Iæ  yoõ providå youò owî breaë handler¬  yoõ wilì wanô tï disablå 
thå  built-iî  handler®   Jusô makå surå thaô yoõ  includeä  thaô 
handleò  iî  thå  lisô  oæ  possiblå  exits¬  sï  thaô  iô  calló 
sound_done() before terminating the application.  

Iæ  yoõ don'ô havå á breaë handleò builô iî tï  thå  application¬ 
let sound_init() put one in for you.

OK¬  no÷   yoõ  kno÷ thaô youò applicatioî shoulä looë  somethinç 
like this:

     main()
     {
          sound_init(m,1);
          .
          .     
          .
          sound_done();
     }

That'ó  prettù  boring®   Yoõ caî spicå iô uğ afteò  readinç  thå 
sectionó  "Makinç  Music¢ anä "Makinç Noise"®   Onå  morå  usefuì 
functioî beforå yoõ gï ..®  quiet()®   Iæ yoõ seô uğ á lonç piecå 
oæ  backgrounä music¬  anä foò somå reasoî havå tï kilì iô  earlù 
(buô noô geô readù tï exit)¬  calì quiet()®   Iô haó nï effecô iî 
Foregrounä modes.


                           ----------

     (*)  The enhanced modes currently produce the same
          results as the standard modes.  In a future 
          version these modes will provide better time
          resolution.  See "Tech Tips" for details.
.paŠ.he Sound Effects                                        Making Music

                          Making Music 
                          (Using Play)

Thå  plaù functioî translateó á musicaì scorå intï  sounds®   Thå 
scorå ió writteî usinç á speciaì notatioî describeä below®   Thió 
notatioî  allowó  thå  uså oæ ¸ octaveó oæ 1²  noteó  each¬  witè 
various tempos, etc.  The format of pla() is:

     void play(m)
     char *m;

Commandó arå á singlå letteò followeä immediatelù bù onå oò  morå 
arguments¬  iæ  necessary®   Spaces¬  commas¬  anä semicolonó maù 
appeaò betweeî commandó foò clarity¬ buô arå ignoreä bù play().


A to G:   Theså arå thå noteó Á througè G¬ iî thå currenô octave®  
          Á  notå  maù bå followeä bù uğ tï threå  modifiers¬  iî 
          thió ordeò only:

               Sharp/Flaô indicationº  £ oò « ió sharp;
                                       - ió flat.
               Notå lengthº  numbeò froí ± tï 6´ (seå L)
               Dotsº Uğ tï 10 dots.  A dotted note plays for 3/2
                     of it's normal time.  Two dots = 9/4, three
                     dots = 27/8, etc.

          Examplås (assuminç thå currenô notå lengtè ió 4):

               C+        C sharp 1/4 note
               C+8       C sharp 1/8 note
               B-®       Ã sharğ 1/´ notå dotteä ½ 3/¸ note
               A2.       A 1/2 note dotted = 3/4 note


Ln        Setó thå currenô notå length®  Notå lengtè ió 1/n¬ sï á 
          parameteò  oæ ´ wilì seô subsequenô notå tï 1/´  notes®  
          Individuaì  noteó maù overridå thå currenô lengtè  witè 
          aî expliciô lengtè (seå abovå examples)®   Thå rangå ió 
          ± tï 64.

          Notå  lengtè  combineó  witè  tempï  tï  determinå  thå 
          duratioî oæ thå note®  Lengtè ió measureä aó á fractioî 
          oæ  á wholå note¬  whilå tempï ió iî quarter-noteó  peò 
          second®   Foò  example¬  witè á tempï oæ 3² anä á  notå 
          lengtè oæ 2¬ á notå wilì lasô foò 1/1¶ oæ á second.

.cp 10ŠMx        Sets the mode of the music.  There are three modes:

             x=N (NORMAL)º   noteó arå playeä foò 7/¸ oæ thå notå 
                 time¬ witè thå remaininç 1/¸ beinç á rest.

             x=S (STACCATO)º noteó arå playeä foò 3/´ oæ thå notå 
                 time¬ witè thå remaininç 1/´ beinç á rest.

             x=L (LEGATO)º  noteó  arå playeä foò thå  fulì  notå 
                 time¬ witè nï rest.

          Thå modeó Foregrounä anä Backgrounä havå nothinç tï  dï 
          witè theså modeó !

Nn        Playó notå î (rangå 0..84)¬  wherå ° meanó silence®  Iæ 
          thå  argumenô ió missinç oò ouô oæ range¬  nï  notå  ió 
          played.  Cannot be dotted or given explicit length.

On        Setó octavå tï î (rangå 0..7)®   Iæ argumenô ió ouô  oæ 
          range, current octave remains unchanged.

P[n][.]   Pauså oò rest»   seå thå ruleó foò notå lengtè (n©  anä 
          dottinç  foò  thå  regulaò noteó  A-Ç  above®   Iæ  thå 
          argument is missing or invalid, no pause takes place.

R         Resets to default values.  Resets the following:
                    Octave = 4
                    Length = 1
                    Mode = Normal
                    Tempo = 120

Tn        Tempo¬  whicè  maù rangå froí 3² tï 255¬  controló  thå 
          numbeò  oæ quarter-noteó peò second®   Thå  defaulô  ió 
          120.

<         Moveó dowî onå octave®   Iæ alreadù aô octavå 0¬  stayó 
          there.

>         Moveó  uğ onå octave®   Iæ alreadù aô octavå  7¬  stayó 
          there.


.paŠ.he Sound Effects                                        Making Noise

                          Making Noise 
                    (Using Sound and Sounds)

Thå  functioî  sound(© anä sounds(© allo÷ thå prograí tï  producå 
soundó otheò thaî thoså oî thå normaì musicaì scale®  Thå penaltù 
foò  thió flexibilitù ió thaô morå worë ió usuallù  requireä   tï 
specifù thå frequencù anä duratioî oæ eacè sound¬ especiallù wheî 
forming complex noises.

Tï  producå á singlå sound¬  calì  sound()®   Simple¬  eh¿   Jusô 
providå  thå  frequencù  aó  (Hú ª 100)¬  anä  thå  duratioî  iî 
milliseconds®   Tï producå á serieó oæ sounds¬  yoõ caî seô uğ aî 
arraù  oæ  structureó  oæ thå typå sound_elemenô anä pasó  iô  tï 
sounds()¬  alonç  witè á counô oæ thå numbeò oæ  elements®   Eacè 
elemenô  takeó uğ siø bytes»  fouò byteó foò thå frequencù  (lonç 
int© anä twï foò thå duratioî (unsigned).

.paŠ.he Sounä Effectó                               Functioî Descriptions

                      Summary Function List

Theså  functionó  arå describeä iî detaiì later¬  buô herå  ió  á 
comprehensivå lisô oæ thå functionó iî thå library¬ witè thå filå 
locatioî anä á shorô descriptioî oæ eacè one.


                           High-Level

sound_init   SOUNDCTL    Call to set mode, etc.
sound_done   SOUNDCTL    Call before exit.
sound_mode   SOUNDCTL    Returns current mode.
sound        SOUND       Make a noise.
sounds       SOUND       Make several noises.
plaù         PLAY        Makå pleasanô noiseó usinç easù notation.
quiet        SOUNDOUT    Kill playing background music.
sound_bchk   SOUNDOUT    Check status of sound buffer.
 
                            Low-Level
          
spkr_on      SPKRCTL     Speaker on  (continuous noise) 
spkr_off     SPKRCTL     Speaker off (blissful quiet)
spkr_freq    SPKRCTL     Sets the frequency of the noise
spkr_cntò    SPKRCTL     Setó frequencù alsï (seå funã description)
          
                     Internal --- DO NOT USE
          
sound_out    SOUNDOUT    Interrupt-driven output routine
snd_irh      SOUNDINT    Assembly interface for sound_out
snd_brk      SOUNDINT    Built-in break handler
snd_giv      SOUNDINT    Utility - get interrupt vector
snd_siv      SOUNDINT    Utility - set interrupt vector
delay        DELAY       Internal delay loop used in mode 1               
.paŠ                      SOUND_INIT and SOUND_DONE

Purpose:

     Seô uğ anä teaò dowî thå interrupô vectoró needeä tï providå 
     sound.

Summary:

     int sound_init(mode,install_bh)
     int mode, install_bh;

     int sound_done();

Parameters:

     Mode:          Musô bå iî thå rangå 1..5»  setó thå modå foò 
                    subsequenô   calló  tï  sound(©  anä  play()®  
                    Values are:

                     1  Foreground w/ Delay Loop               
                     2  Foreground w/ Standard Clock Interrupt 
                     3  Foreground w/ Enhanced Clock Interrupt
                     4  Background w/ Standard Clock Interrupt 
                     5  Background w/ Enhanced Clock Interrupt

     Install_bh:    Iæ  thió  ió  0¬  nï  break-handleò  wilì  bå 
                    installed®   Otherwise¬  á breaë handleò wilì 
                    bå installed®   Seå Technicaì Informatioî foò 
                    á completå descriptioî oæ thå breaë handler.

Returns:

     Zerï  indicateó success®   Sound_iniô wilì returî -±  iæ  aî 
     invaliä modå ió passed.

Notes:

     Sound_init(©  maù  bå calleä morå thaî oncå withouô  harmfuì 
     effects®   Wheî called¬  anù musiã currentlù playinç wilì bå 
     killed®   Yoõ caî uså calló tï sound_init(© tï changå  modeó 
     durinç thå application.

     Sound_done(© shusô ofæ backgrounä musiã anä thå speaker¬ anä 
     cleanó  uğ anù interrupô vectoró whicè maù havå beeî changeä 
     bù sound_init()®  Thió letó thå applicatioî safelù exit.

.paŠ                           SOUND_MODE

Purpose:

     Returnó  thå currenô sounä mode®   Seå sound_init(© foò  thå 
     possible values.

Summary:

     int sound_mode()

Parameters:

     None

Returns:

     Returnó   currenô  mode¬   rangå  1-5®    Seå   sound_init(© 
     description for complete list of modes.

.paŠ                        SOUND  &  SOUNDS

Purpose:

     Producå á sounä oò soundó foò á certaiî time.

Summary:

     void sound(freq,dur)
     long freq;
     unsigned dur;

     void sounds(n,sa)
     int n;
     struct sound_desc *sa;     

Parameters:

     freq:  Frequencù iî MHú ª 10®   Exº 400MHú passeä aó 40000L®  
            Thå  allowablå  rangå ió ???®   Á frequencù oæ  °  ió 
            treateä  aó "silence"®   Á sounä witè á duratioî oæ ° 
            is ignored.

     dur:   Duration of sound in milliseconds.

     n:     Numbeò oæ soundó passed®   Numberó lesó thaî zerï arå 
            treated as zero.

     sa:    Arraù  oæ  sounä  descriptions¬   eacè  containinç  á 
            frequencù  anä á duration¬  aó peò thå freñ  anä  duò 
            parameteró passeä tï sound.

Returns:

     0 if all parameters all OK
    -1 if error in parameters (out of range).     

Error Handling:

     Checks parameter range only.

Notes:

     Theså  functionó  arå effecteä bù thå modå currentlù seô  bù 
     thå  mosô recenô calì tï sound_init®   Theù maù bå useä  foò 
     either foreground or background operation.

.paŠ                              PLAY

Purpose:

     Plaù á serieó oæ musicaì noteó usinç aî easù notation.

Summary:

     void play(music)
     char *music;

Parameters:

     Thå  musiã  parameteò  ió á strinç whicè  caî  contaiî  manù 
     compleø  operations¬  alì  oæ  whicè arå  describeä  iî  thå 
     section "Making Music".

Returns:

     Nothing.

Error Handling:

     Anù  problemó encountereä iî thå musiã strinç arå handleä aó 
     describeä iî thå section "Making Music."

Notes:

     Thå  plaù functioî introduceó aî amounô oæ overheaä iî termó 
     oæ codå size¬  aó iô musô parså thå string®  Á prograí whicè 
     ió  memory-criticaì  shoulä uså  sounds()»   oæ  courså  thå 
     programmeò  musô  theî perforí thå tasë oæ  convertinç  eacè 
     notå intï onå oò morå sounds® 

     See "Making Music" for details on play()'s operation.

.paŠ                DIRECT SPEAKER CONTROL FUNCTIONS

Purpose:

     Direct control of speaker port.

Summary:

     void spkr_on()

     void spkr_off()

     void spkr_freq(f)
     long f;

     void spkr_cntr(c)
     unsigned c;

Parameters:

     Thå  parameteò  tï spkr_freñ ió thå frequencù iî MHú tï  seô 
     thå  speakeò to®   Thå parameteò tï spkr_cntò ió thå  actuaì 
     counteò  valuå tï bå passeä tï thå 825³  timeò  chip®   Notå 
     thaô  thå onlù functionó tï actuallù turî thå speakeò oî  oò 
     ofæ  arå spkr_oî anä spkr_off»   settinç thå frequencù  doeó 
     not imply activating or deactivating the speaker.

Returns:

     Nothing.

Error Handling:

     None.  

Notes:

     Unlikå sound()¬  sounds()¬  anä play()¬  whicè caî bå freelù 
     intermixed¬  uså  oæ  theså  low-leveì  functionó  whilå  iî 
     backgrounä  modå  caî disrupô thå backgrounä  music®   Whilå 
     thió  ió faò froí fatal¬  ió caî producå unpleasanô  noises®  
     Calì quiet(© beforå usinç theså functions.

.paŠ
                   BACKGROUND-BUFFER FUNCTIONS

Purpose:

     Control music playing in background.

Summary:

     void quiet()

     void sound_bchk(used,avail)
     int *used, *avail;

Parameters:         

     quite:              none.

     sound_buffchk():    used to return values (see below).

Returns:            

     quiet() has no return value.

     buffchk(© returnó thå numbeò oæ sounä elementó iî thå buffeò 
     anä thå numbeò oæ freå elements¬  viá thå parameteró  "used¢ 
     anä "avail¢ respectively.

Error Handling:     

     None.

Notes:

     Á  calì tï quieô wilì kilì anù backgrounä music¬  flusè  thå 
     buffer¬ anä shuô ofæ thå speaker®  

.paŠ.he Sound Effects                               Technical Information

                     =======================
                      TECHNICAL INFORMATION
                     =======================

É  havå trieä tï bå cleaò anä preciså iî theså  technicaì  notes®  
Shoulä  yoõ  finä anù erroró iî codå oò  documentation¬  oò  havå 
suggestionó foò improvement¬   É woulä appreciatå youò  feedback®  
Theså  paragraphó  arå  noô foò thå fainô  oæ  heart®   Foò  morå 
details¬  É  suggesô somå oæ Peteò Norton'ó  excellenô PÃ  books¬ 
anä thå ever-cryptiã buô fact-filleä IBÍ Technicaì Reference.

Here is a brief summary of this section:


     Timing Sound Duration (MODES)
        Delay Loop - How, Pro & Con
        Timer Interrupt - How, Pro & Con
        Enhanced Interrupt - How, Pro & Con

     Sound Generation Mechanics
        Speaker Logic
        Setting The Frequency

     The Background Buffer

     The Break Handler

     The Interrupt Handler

          
                    =========================
                    TIMING THE SOUND DURATION
                    =========================

Therå  arå fivå modeó iî whicè thå sounä routineó caî run®   Theù 
definå  WHEÎ  thå musiã plays¬  anä ho÷ thå  propeò  DURATIOÎ  ió 
determined®  Thå FREQUENCÙ oæ thå soundó ió alwayó determineä anä 
produceä bù thå samå methoä regardlesó oæ mode¬  anä ió describeä 
á fe÷ paragraphó below.

  Mode   When          Timing
  ----   ----          ------
    1    Foreground    Delay Loop
    2    Foreground    Standard Clock Interrupt
    3    Foreground    Enhanced Clock Interrupt
    4    Background    Standard Clock Interrupt
    5    Background    Enhanced Clock Interrupt

Thå  defaulô modå ió modå 1®   Iô poseó thå fewesô problems¬  buô 
haó somå limitations®  Thå timinç ió achieveä usinç á delaù loop¬ 
whicè  ió  simplù  á smalì piecå oæ codå witè á  knowî  executioî 
time®   Bù loopinç througè thió piecå oæ codå yoõ caî approximatå 
thå duratioî oæ thå soundó fairlù well®   
ŠUnfortunately¬  thå  delaù looğ methoä haó problems®   Iô ió verù 
dependenô oî thå hardware, for one thing®   Á processoò  runninç 
aô  8MHú  wilì  executå thå codå iî closå tï halæ thå timå  oæ  á 
standarä  PÃ runninç aô 4.77MHz¬  sï thå soundó wilì bå  shorter®  
Also¬ thå timinç becomeó dependenô oî processoò type®  Thå normaì 
PC has an 8088;  oî aî  AT&Ô 6300  (8086) oò oî a PC-AÔ (80286),
therå  wilì bå á noticeablå timinç differencå duå tï thå  varyinç 
buó widthó anä executioî speeds¬ eveî iæ thå baså processoò clocë 
speeä waó thå same®   Anä aó thå coup-de-grace¬  thió methoä wilì 
bå throwî ofæ bù thå occurancå oæ interrupts®   Aî interrupô wilì 
causå  otheò codå tï bå executeä whicè wilì extenä thå  executioî 
timå oæ thå loop.

Fortunatelù therå ió á betteò timinç methoä available®   Therå ió 
aî  on-boarä maiî systeí clocë chiğ whicè provideó á pulså witè á 
frequencù  oæ abouô 1.19MHz®   Thió ió steppeä dowî tï  á  morå 
reasonablå ratå bù thå 825³ counteò chip®   Thå mosô familiaò uså 
oæ  thió ió tï providå thå systeí tick¬  whicè occuró 18.² timå á 
seconä anä generateó thå hardwarå clocë interrupô (IRQ0¬  INÔ 8)®  
Thió  ió  generallù  independenô  oæ  thå  clocë  speeä  oæ   thå 
processor¬  anä sï ió á gooä timinç sourcå acrosó thå extendeä PÃ 
family.

Wå caî uså thió systeí ticë tï timå thå sounds®   Botè foregrounä 
anä  backgrounä methodó caî dï this»   thå foregrounä modeó  wilì 
merelù  waiô  arounä  untiì thå sounä  ió  over®   Thereforå  thå 
followinç  discussionó  oæ thå uså oæ thå systeí  ticë  interrupô 
applù tï botè foregrounä anä background.

Thå  standarä  interrupô modeó (² anä 4© tiå  intï  thå  softwarå 
interrupô  vectoò  0x1C®   Thió  ió thå  "useò  timeò  interrupt¢ 
vector¬ anä ió provideä bù thå BIOÓ aó á nicå waù tï tiå softwarå 
intï   thå  timer®    Thå  BIOÓ  interrupô  handleò  retainó  alì 
responsibilitù  foò handlinç thå messù taskó oæ  sendinç  end-of-
interrupô  tï  thå interrupô controlleò  chip¬  incrementinç  thå 
time-of-daù  clocë tick¬  etc®   Thió ió á cleaî waù tï  uså  thå 
system tick to time events.

                        Possible Problems

Therå  arå  onlù twï possiblå problemó (thaô É caî see© tï  usinç 
thå  systeí  tick®   Onå  ió thaô somå  memory-residenô  softwarå 
packageó  arå verù possessivå abouô interrupts®   Thaô ió whù  sï 
manù oæ theí arå incompatiblå witè eacè other®   Iî  theory¬  anù 
numbeò  oæ  driveró coulä sharå thå useò systeí ticë bù  chaininç 
themselveó together¬  buô theù ofteî don't®   Thió softwarå does¬ 
sï iô wilì worë witè well-behaveä utilities.

Thå otheò probleí mainlù involveó backgrounä mode®   Iæ thå  useò 
abortó thå prograí bù usinç controì Ctrl-Break¬ interrupô vectoró 
wilì  noô bå restored¬  anä eventuallù thå systeí wilì crasè  anä 
neeä  rebooting®   Thió  caî bå preventeä bù usinç  thå  provideä 
breaë handleò (seå SOUND_INIT© oò bù callinç sound_done(© iæ youò 
applicatioî alreadù provideó itó owî breaë handler.
Š                         Enhanced Modes 

Thå  enhanceä  interrupô  modeó  (³ anä  5©  arå  noô  yeô  fullù 
implemented¬  anä  arå  presentlù  thå  samå aó  modeó  ²  anä  ´ 
respectively®   Iî á futurå release¬ theù wilì follo÷ thå examplå 
oæ  BASIÃ anä changå thå systeí ticë generatioî tï providå betteò 
resolution®   Thió ticë ió speä uğ bù á factoò oæ 4®   Thå  sounä 
systeí  musô intercepô thió ticë aô thå INÔ ¸ level¬  anä providå 
thå ticë tï thå BIOÓ onlù everù fourtè time¬  tï keeğ thå  systeí 
time-of-daù  clocë froí speedinç ahead®   Thå advantagå ió betteò 
timå resolution.

Thå  disadvantageó tï thå enhanceä modeó includå alì oæ thå  oneó 
giveî foò thå standarä clocë modes¬ pluó thå codå haó tï diç eveî 
deepeò  intï  territorù  wherå  applicationó  programó  arå   noô 
encourageä  tï  venture®   Still¬  takinç propeò carå tï  restorå 
vectoró upoî exit¬  thió shoulä bå cleaî enougè foò everydaù use®  
Therå ió á questioî aó tï thå valuå oæ thå morå preciså timinç oæ 
thå sounds¬ whicè maù noô bå oæ greaô importancå anyway.


                   ==========================
                   SOUND GENERATION MECHANICS
                   ==========================

                          Speaker Logic

Thå  soundó  arå produceä usinç thå speakeò attacheä tï  thå  IBÍ 
motherboard®   Thå  speakeò  ió pulseä tï providå  sounä  oæ  thå 
desireä  frequency®   Thå pulsinç actioî ió provideä courtesù  oæ 
thå   maiî   systeí  clock¬   steppeä  dowî  througè   thå   825³ 
programmablå counter®  Therå ió alsï aî on/ofæ switcè provideä bù 
á  biô  iî  thå  PPÉ chip®   Thå  speakeò  controì  circuitrù  ió 
logicallù (noô electrically© diagrammeä as:

    +-------+    +--------+
    | 8284A |--->| 8253-5 |----+                      
    +-------+    +--------+    |    ____               /|
                               +--> )   \             / |
                                    |AND >---------->[  |
                               +--> )___/             \ |
              +-----+          |                       \|
              | PPI |----------+                    
              +-----+                                Speaker

Thå  PPÉ switcè ió accesseä aó bitó ° anä ± aô I/Ï addresó  0x61®  
Wheî thå bitó arå seô thå speakeò switcè ió on¬  wheî cleareä thå 
speakeò  switcè  ió  off®    Seå  thå  spkr_on(©  anä  spkr_off(© 
functionó tï seå ho÷ tï dï thió froí C®   Notå thaô thå valuå  oæ 
thå  PPÉ  ió  firsô read¬  thå requireä bitó  changed¬  anä  theî 
writteî  out®   Thió ió necessarù becauså thå PPÉ haó manù  otheò 
useó foò thå resô oæ thå bits.

.cp 6Š                Setting Frequency using the 8253

Thå   systeí  clocë  oscillateó  aô  abouô  1.19MHz®    Thå  825³ 
programmablå counteò stepó dowî thió frequencù bù sendinç á pulså 
foò  everù sï manù inpuô pulses®   Thå well-knowî systeí ticë  oæ 
18.²  tickó peò seconä ió obtaineä usinç thió chiğ anä á  divisoò 
oæ 0xFFFF®  Thå chiğ haó twï counters»  whilå onå outpuô connectó 
tï  thå systeí clocë interrupt¬  thå otheò tieó tï  thå  speaker®  
So¬  bù  changinç thå divisoò iî thå counter¬  wå caî changå  thå 
frequencù  oæ  thå  pulseó  senô tï thå  speakeò  anä  hencå  thå 
frequencù oæ thå sounä iô produces.

Foò  morå  detailó oî thå uså oæ thå 825³  programmablå  counter¬ 
consult the Intel part spec.  


                      =====================
                      THE BACKGROUND BUFFER
                      =====================

Soundó  tï bå playeä iî modeó ² througè µ arå placeä iî á  buffeò 
anä  playeä  undeò interrupô control®   Sincå thió buffeò  ió  oæ 
finitå size¬ iô ió possiblå tï overflow®  Overflowinç soundó wilì 
bå discarded.

Eacè entrù takeó uğ fouò (4© bytes¬  anä thå numbeò oæ entrieó iî 
thå  buffeò  ió fixeä wheî yoõ builä thå library®   Thå  compileä 
fileó oî thå disë havå á defaulô buffeò sizå oæ 6´ entries®   Yoõ 
caî   changå  thió  bù  changinç  thå  valuå  oæ   thå   constanô 
SND_BUFFSIZÅ iî SOUND.È anä recompilinç thå system.

Eacè  notå senô tï play(© wilì usuallù generatå twï entries¬  onå 
foò thå notå anä onå foò thå inter-notå pause®  Usinç sound(© anä 
sounds(© wilì generatå exactlù onå entrù peò sounä element.

Thå  sounä buffeò ió circular¬  sï thaô aó entrieó arå outpuô  tï 
thå speaker¬  morå caî bå added®   Checë thå statuó oæ thå buffeò 
usinç thå functioî sound_bchk()¬  whicè wilì geô yoõ botè  thå 
numbeò oæ entrieó useä anä thå numbeò oæ entrieó free.


                       ===================
                        THE BREAK HANDLER
                       ===================

Thå  built-iî  breaë handleò haó á simplistiã vie÷ oæ  life®   Iô 
acceptó  control¬  calló sound_done(© tï cleaî  up¬  theî  passeó 
controì  tï thå breaë handleò thaô precedeó it®   Thió meanó thaô 
thå usuaì neô resulô ió aî exiô tï DOS¬ buô safely®  Feeì freå tï 
uså  thå  giveî functioî aó á template¬  buô  keeğ  thå  originaì 
arounä iî caså yoõ accidentallù mucë iô uğ á bit.

.cp 15Š                     =======================
                      THE INTERRUPT HANDLER
                     =======================

Thió  referó   tï  thå timeò interrupô  handler¬  á  verù  simplå 
routine®   Itó  joâ ió tï savå thå registers¬  loaä  thå  segmenô 
registeró thaô Ã functionó expect¬ calì sound_out(© tï dï alì thå 
work¬  anä restorå alì thå registers®   Iô theî calló thå routinå 
whicè  waó  previouslù  thå interrupô handler®   Thió ió  á  nicå 
courteouó  thinç  tï do¬  aó iô allowó sharinç oæ  thió  valuablå 
resource¬ thå systeí tick.


.paŠ                      WHEN THINGS GO WRONG

Firsô oæ all¬  pleaså feeì freå tï asë må (thå author© questions®  
É cannoô accepô phonå questionó aô thió time¬ mainlù becauså É aí 
noô  neaò anù particulaò phonå durinç thå day®   Yoõ caî reacè må 
bù maiì oò bù CompuServå EASYMAIÌ (73047,3715)®   Buô first¬  seå 
iæ thå followinç lisô haó youò probleí oî it.


"I cannot read the distribution disk."

     Thå  distributioî  disë ió provideä iî IBÍ  double-sideä  9-
     sectoò format®  Yoõ wilì noô bå ablå tï reaä iô witè single-
     sideä driveó oò witè á DOÓ versioî beforå 2.0.

     Iæ yoõ caî reaä sucè diskó normally¬  therå ió á chancå thaô 
     thå diskettå haó beeî damageä iî transit®  Pleaså returî thå 
     diskette and you will get another copy, no charge.


"The files will not compile on my system."

     Iæ  yoõ arå usinç á non-supporteä compiler¬  alì É caî dï ió 
     refeò yoõ tï thå sectioî oî Settinç Uğ foò Otheò Compilers"®  
     Iæ  yoõ  dï  geô  everythinç working¬  eveî  iæ  jusô  oî  á 
     differenô  versioî  oæ  Latticå  oò  Manx/Aztec¬   É   woulä 
     appreciatå  iæ yoõ leô må know®   É wilì dï everythinç É caî 
     tï helğ yoõ geô iô compileä anä running¬  buô withouô á copù 
     oæ  thå  compileò (DÏ NOÔ SENÄ MÅ  COPYRIGHTEÄ  SOFTWARE©  É 
     cannot promise much.

     Bå  surå  yoõ havå thå filå SOUND.È wherå youò compileò  caî 
     finä  it®   Alsï bå surå thaô yoõ havå enougè rooí  oî  youò 
     diskettes for the compiler's output.

"My system locks up when I run a program using sound."

     First¬  iæ yoõ havå anù memory-residenô utilities¬ let'ó geô 
     riä  oæ theí foò thå moment®   De-instalì them¬  eveî removå 
     theí  froí youò AUTOEXEC.BAÔ file¬  theî rebooô thå  system®  
     Try the program again.  If it still crashes ...

     Make sure you are calling quiet() before the program exits.

.paŠ

                           ==========
                           CHANGE LOG
                           ==========

Version 1.0b  (OPEN)

        Added new file SOUNDP.H containing prototypes for all
        user-callable functions, for compilers which support
        prototyping.

        Added support for Ecosoft Eco-C88 compiler.

        Compressed definition of Install in SOUNDCTL, by combining
        all definitions using typedef's and #defines to allow for
        compiler and library differences.


Version 1.0a  (2/20/85)

        Delay now written in assembler.

        Corrected error in play(), which would not play dotted
        notes if a length was also specified.  

        Corrected error in SOUND.H's definition of MS2TICKS, which
        was miscalculated and rounding badly.
